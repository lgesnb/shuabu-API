name: shua
on:
  schedule:
    - cron: '05 11 * * *'  # 每天UTC时间11:05运行（北京时间19:05）
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout代码
        uses: actions/checkout@v4
      
      - name: 配置Python环境
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      
      - name: 安装依赖
        run: pip install --no-cache-dir requests
      
      - name: 运行Python脚本并记录时间
        run: |
          user="${{ secrets.USER }}"
          passwd="${{ secrets.PWD }}"
          python3 main.py "$user" "$passwd"
          
          # 统一记录执行时间（仅保留最后时间）
          time=$(TZ=Asia/Shanghai date +'%Y-%m-%d %H:%M:%S')
          echo "执行完成时间: $time（北京时间）"
          echo "最后执行时间: $time" >> last_run.txt
        if: always()